{% extends "base.html" %}
{% block content %}
    <nav aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="/dashboard">Dashboard</a></li><li class="breadcrumb-item active">{{ organization.name }}</li></ol></nav>
    <div class="d-flex justify-content-between align-items-start mb-4">
        <div><h2>{{ organization.name }}</h2><p class="text-muted">{{ organization.industry or 'General' }} | {{ organization.total_headcount or 0 }} Employees</p></div>
        <a href="/chat/{{ organization.id }}" class="btn btn-primary"><i class="bi bi-chat-dots me-2"></i>AI Consultant</a>
    </div>
    <div class="row g-3 mb-4">
        <div class="col-md-3"><div class="card metric-card"><div class="metric-value">{{ organization.total_headcount or '--' }}</div><div class="metric-label">Headcount</div></div></div>
        <div class="col-md-3"><div class="card metric-card"><div class="metric-value {{ 'score-good' if organization.turnover_rate and organization.turnover_rate < 15 else 'score-poor' if organization.turnover_rate else '' }}">{{ "%.1f"|format(organization.turnover_rate) if organization.turnover_rate else '--' }}%</div><div class="metric-label">Turnover Rate</div></div></div>
        <div class="col-md-3"><div class="card metric-card"><div class="metric-value {{ 'score-excellent' if organization.engagement_score and organization.engagement_score >= 80 else 'score-good' if organization.engagement_score and organization.engagement_score >= 70 else '' }}">{{ "%.0f"|format(organization.engagement_score) if organization.engagement_score else '--' }}</div><div class="metric-label">Engagement Score</div></div></div>
        <div class="col-md-3"><div class="card metric-card"><div class="metric-value">{{ employees|length }}</div><div class="metric-label">Active Employees</div></div></div>
    </div>
    <div class="row g-4">
        <div class="col-lg-8">
            <div class="card mb-4">
                <div class="card-header d-flex justify-content-between"><h5 class="mb-0">Talent Distribution</h5></div>
                <div class="card-body">
                    {% if talent_distribution %}
                    <div class="row">
                        {% for cat, count in talent_distribution.items() %}
                        <div class="col-md-4 mb-2"><span class="badge bg-secondary me-2">{{ count }}</span>{{ cat }}</div>
                        {% endfor %}
                    </div>
                    {% else %}<p class="text-muted text-center">No talent data</p>{% endif %}
                </div>
            </div>
            <div class="card">
                <div class="card-header"><h5 class="mb-0">Flight Risk Summary</h5></div>
                <div class="card-body">
                    {% if flight_risk %}
                    <div class="row">
                        {% for risk, count in flight_risk.items() %}
                        <div class="col-md-3 mb-2"><span class="badge {{ 'risk-critical' if risk == 'Critical' else 'risk-high' if risk == 'High' else 'risk-medium' if risk == 'Medium' else 'risk-low' }} me-2">{{ count }}</span>{{ risk }}</div>
                        {% endfor %}
                    </div>
                    {% else %}<p class="text-muted text-center">No flight risk data</p>{% endif %}
                </div>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="card">
                <div class="card-header"><i class="bi bi-lightning me-2"></i>Quick Actions</div>
                <div class="card-body d-grid gap-2">
                    <button class="btn btn-success" onclick="runBenchmark()"><i class="bi bi-bar-chart me-2"></i>Run HR Benchmark</button>
                    <a href="/chat/{{ organization.id }}" class="btn btn-outline-primary"><i class="bi bi-chat-dots me-2"></i>Ask AI CHRO</a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block extra_js %}
<script>
async function runBenchmark() {
    try {
        const r = await apiCall('/api/organizations/{{ organization.id }}/benchmark', 'POST');
        if (r.success) alert('Benchmark Score: ' + r.benchmark.overall_score.toFixed(0) + ' (' + r.benchmark.overall_rating + ')');
    } catch (e) { alert(e.message); }
}
</script>
{% endblock %}
